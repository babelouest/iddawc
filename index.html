<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Iddawc: Iddawc - OAuth2 client library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Iddawc
   </div>
   <div id="projectbrief">Handle the flow of OAuth2 and OpenID Connect authentication process from the client side.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Iddawc - OAuth2 client library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.com/babelouest/iddawc"></a> </p><div class="image">
<object type="image/svg+xml" data="https://github.com/babelouest/iddawc/workflows/.github/workflows/ccpp.yml/badge.svg" alt=".github/workflows/ccpp.yml"></object>
</div>
<p>Handles the OAuth2 and OpenID Connect authentication process flow from the client side.</p><ul>
<li>Genrates requests based on input parameters</li>
<li>Parses response</li>
<li>Validates response values</li>
</ul>
<p>Example for <code>code</code> and <code>id_token</code> response types on an OpenID Connect server.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="iddawc_8h.html">iddawc.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() {</div><div class="line">  <span class="keyword">struct </span><a class="code" href="struct__i__session.html">_i_session</a> i_session;</div><div class="line"></div><div class="line">  <a class="code" href="group__core.html#ga43fa354058e5ebc2c4d02ef3e9e62687">i_init_session</a>(&amp;i_session);</div><div class="line">  <a class="code" href="group__properties.html#ga74f0a21ec2933521d50a93062a2ff522">i_set_parameter_list</a>(&amp;i_session, <a class="code" href="group__const.html#gga354b1fe8a1449635c2f818219f612706ad784b2e55cb95f331bd67212418b3323">I_OPT_RESPONSE_TYPE</a>, <a class="code" href="group__const.html#ga1a02bd6006b9e1af5f0bc894cbd9363a">I_RESPONSE_TYPE_ID_TOKEN</a>|<a class="code" href="group__const.html#ga46910e72294f8c5da83564a34a678605">I_RESPONSE_TYPE_CODE</a>,</div><div class="line">                                   <a class="code" href="group__const.html#gga354b1fe8a1449635c2f818219f612706a5dcda0d36970e7080d685e62ab9a867c">I_OPT_OPENID_CONFIG_ENDPOINT</a>, <span class="stringliteral">&quot;https://oidc.tld/.well-known/openid-configuration&quot;</span>,</div><div class="line">                                   <a class="code" href="group__const.html#gga354b1fe8a1449635c2f818219f612706ad555d67cfd0d1d15c50f73f308ff4b40">I_OPT_CLIENT_ID</a>, <span class="stringliteral">&quot;client1&quot;</span>,</div><div class="line">                                   I_OPT_CIENT_SECRET, <span class="stringliteral">&quot;mySecret&quot;</span>,</div><div class="line">                                   <a class="code" href="group__const.html#gga354b1fe8a1449635c2f818219f612706a84c02139d19ad119ecb860eb863d112c">I_OPT_REDIRECT_URI</a>, <span class="stringliteral">&quot;https://my-client.tld&quot;</span>,</div><div class="line">                                   <a class="code" href="group__const.html#gga354b1fe8a1449635c2f818219f612706aee9b0f29db48b158568705694b73a1f9">I_OPT_SCOPE</a>, <span class="stringliteral">&quot;openid&quot;</span>,</div><div class="line">                                   <a class="code" href="group__const.html#gga354b1fe8a1449635c2f818219f612706ac4a9e236a3a626179f89e30a49a68961">I_OPT_STATE_GENERATE</a>, 16,</div><div class="line">                                   <a class="code" href="group__const.html#gga354b1fe8a1449635c2f818219f612706af04663bc99cdb72a8e11a0a7743d161d">I_OPT_NONCE_GENERATE</a>, 32,</div><div class="line">                                   <a class="code" href="group__const.html#gga354b1fe8a1449635c2f818219f612706a72d26a750fcc218aac5e3981e0b8fc22">I_OPT_NONE</a>);</div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__properties.html#gaf719b590f20f10e11ecf36d803f0ac6f">i_load_openid_config</a>(&amp;i_session)) {</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Error loading openid-configuration\n&quot;</span>);</div><div class="line">    <a class="code" href="group__core.html#ga6a2fefde91c578c8c2f6b0297e3ee058">i_clean_session</a>(&amp;i_session);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// First step: get redirection to login page</span></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__run.html#ga1a31bc20153cb660fe8224563cd96bb1">i_build_auth_url_get</a>(&amp;i_session)) {</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Error building auth request\n&quot;</span>);</div><div class="line">    <a class="code" href="group__core.html#ga6a2fefde91c578c8c2f6b0297e3ee058">i_clean_session</a>(&amp;i_session);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">  }</div><div class="line">  printf(<span class="stringliteral">&quot;Redirect to: %s\n&quot;</span>, <a class="code" href="group__properties.html#ga713a20ceaade74708265f5f07b042e31">i_get_str_parameter</a>(&amp;i_session, <a class="code" href="group__const.html#gga354b1fe8a1449635c2f818219f612706a950c80f34e5c27496ef2c3c7da8e9655">I_OPT_REDIRECT_TO</a>));</div><div class="line"></div><div class="line">  <span class="comment">// When the user has logged in the external application, gets redirected with a result, we parse the result</span></div><div class="line">  fprintf(stdout, <span class="stringliteral">&quot;Enter redirect URL\n&quot;</span>);</div><div class="line">  fgets(<a class="code" href="struct__i__session.html#a318d52113b796caad834513baa311223">redirect_to</a>, 4096, stdin);</div><div class="line">  <a class="code" href="struct__i__session.html#a318d52113b796caad834513baa311223">redirect_to</a>[strlen(<a class="code" href="struct__i__session.html#a318d52113b796caad834513baa311223">redirect_to</a>)-1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line">  <a class="code" href="group__properties.html#gaad41d80360011b31bc0feb5dbbd3e7f5">i_set_str_parameter</a>(&amp;i_session, <a class="code" href="group__const.html#gga354b1fe8a1449635c2f818219f612706a950c80f34e5c27496ef2c3c7da8e9655">I_OPT_REDIRECT_TO</a>, <a class="code" href="struct__i__session.html#a318d52113b796caad834513baa311223">redirect_to</a>);</div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__properties.html#gab1b1b471252ea5d5e5311edc75e0cd6f">i_parse_redirect_to</a>(&amp;i_session) != <a class="code" href="group__const.html#gac3e719888cb77e5de100927c5697a4ec">I_OK</a>) {</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Error parsing redirect_to url\n&quot;</span>);</div><div class="line">    <a class="code" href="group__core.html#ga6a2fefde91c578c8c2f6b0297e3ee058">i_clean_session</a>(&amp;i_session);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// Run the token request, get the refresh and access tokens</span></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__run.html#gaf251643a2384c854091a2df0314aac8e">i_run_token_request</a>(&amp;i_session) != <a class="code" href="group__const.html#gac3e719888cb77e5de100927c5697a4ec">I_OK</a>) {</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Error running token request\n&quot;</span>);</div><div class="line">    <a class="code" href="group__core.html#ga6a2fefde91c578c8c2f6b0297e3ee058">i_clean_session</a>(&amp;i_session);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// And finally we load user info using the access token</span></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__run.html#ga71428e3bcc19f2ae742c8fe36e5428b7">i_load_userinfo</a>(&amp;i_session) != <a class="code" href="group__const.html#gac3e719888cb77e5de100927c5697a4ec">I_OK</a>) {</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Error loading userinfo\n&quot;</span>);</div><div class="line">    <a class="code" href="group__core.html#ga6a2fefde91c578c8c2f6b0297e3ee058">i_clean_session</a>(&amp;i_session);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">  }</div><div class="line"></div><div class="line">  fprintf(stdout, <span class="stringliteral">&quot;userinfo:\n%s\n&quot;</span>, <a class="code" href="group__properties.html#ga713a20ceaade74708265f5f07b042e31">i_get_str_parameter</a>(&amp;i_session, <a class="code" href="group__const.html#gga354b1fe8a1449635c2f818219f612706af38b0c0c9deffb15855c035130068ce9">I_OPT_USERINFO</a>));</div><div class="line"></div><div class="line">  <span class="comment">// Cleanup session</span></div><div class="line">  <a class="code" href="group__core.html#ga6a2fefde91c578c8c2f6b0297e3ee058">i_clean_session</a>(&amp;i_session);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h2>Install</h2>
<h2>Pre-compiled packages</h2>
<p>You can install Iddawc with a pre-compiled package available in the <a href="https://github.com/babelouest/iddawc/releases/latest/">release pages</a>.</p>
<h2>Manual install</h2>
<h3>Prerequisites</h3>
<p>You must install <a href="https://github.com/babelouest/orcania">liborcania</a>, <a href="https://github.com/babelouest/yder">libyder</a>, <a href="https://github.com/babelouest/ulfius">libulfius</a>, <a href="https://github.com/babelouest/rhonabwy">librhonabwy</a>, <a href="http://www.digip.org/jansson/">jansson</a> (Minimum 2.11) and <a href="https://www.gnutls.org/">GnuTLS</a> first before building libiddawc. Orcania, Yder, Ulfius and Rhonabwy will be automatically installed if missing and you're using cmake.</p>
<h3>CMake - Multi architecture</h3>
<p><a href="https://cmake.org/download/">CMake</a> minimum 3.5 is required.</p>
<p>Run the cmake script in a subdirectory, example:</p>
<div class="fragment"><div class="line">$ git clone https://github.com/babelouest/iddawc.git</div><div class="line">$ cd iddawc/</div><div class="line">$ mkdir build</div><div class="line">$ cd build</div><div class="line">$ cmake ..</div><div class="line">$ make &amp;&amp; sudo make install</div></div><!-- fragment --><p>The available options for cmake are:</p><ul>
<li><code>-DWITH_JOURNALD=[on|off]</code> (default <code>on</code>): Build with journald (SystemD) support</li>
<li><code>-BUILD_IDDAWC_TESTING=[on|off]</code> (default <code>off</code>): Build unit tests</li>
<li><code>-DINSTALL_HEADER=[on|off]</code> (default <code>on</code>): Install header file <code><a class="el" href="iddawc_8h.html">iddawc.h</a></code></li>
<li><code>-DBUILD_RPM=[on|off]</code> (default <code>off</code>): Build RPM package when running <code>make package</code></li>
<li><code>-DCMAKE_BUILD_TYPE=[Debug|Release]</code> (default <code>Release</code>): Compile with debugging symbols or not</li>
</ul>
<h3>Good ol' Makefile</h3>
<p>Download iddawc from github repository, compile and install.</p>
<div class="fragment"><div class="line">$ git clone https://github.com/babelouest/iddawc.git</div><div class="line">$ cd iddawc/src</div><div class="line">$ make</div><div class="line">$ sudo make install</div></div><!-- fragment --><p>By default, the shared library and the header file will be installed in the <code>/usr/local</code> location. To change this setting, you can modify the <code>DESTDIR</code> value in the <code>src/Makefile</code>.</p>
<p>Example: install iddawc in /tmp/lib directory</p>
<div class="fragment"><div class="line">$ cd src</div><div class="line">$ make &amp;&amp; make DESTDIR=/tmp install</div></div><!-- fragment --><p>You can install Iddawc without root permission if your user has write access to <code></code>. A <code>ldconfig</code> command is executed at the end of the install, it will probably fail if you don't have root permission, but this is harmless. If you choose to install Iddawc in another directory, you must set your environment variable <code>LD_LIBRARY_PATH</code> properly.</p>
<h1>API Documentation</h1>
<p>Documentation is available in the documentation page: <a href="https://babelouest.github.io/iddawc/">https://babelouest.github.io/iddawc/</a> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
