<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Iddawc: Iddawc API documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Iddawc
   </div>
   <div id="projectbrief">Handle the flow of OAuth2 and OpenID Connect authentication process from the client side.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Iddawc API documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Iddawc is a C library used to implement OAuth2/OIDC clients according to the <a href="https://tools.ietf.org/html/rfc6749">OAuth2 RFC</a> and the <a href="https://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Specs</a>.</p>
<p>It's based on <a href="https://github.com/babelouest/ulfius">Ulfius</a> library for the HTTP requests and response management and <a href="https://github.com/babelouest/rhonabwy">Rhonabwy</a> library for the JWKs management.</p>
<p>Iddawc supports the following features:</p>
<ul>
<li>Loading openid-configuration endpoints and parsing the results</li>
<li>Making <code>auth</code> requests using the given parameters (<code>client_id</code>, <code>client_secret</code>, <code>redirect_uri</code>, etc.) and parsing the result</li>
<li>Making <code>token</code> requests using the given parameters (<code>code</code>, <code>client_id</code>, <code>client_secret</code>, <code>redirect_uri</code>, etc.) and parsing the result</li>
<li>Making <code>userinfo</code>, <code>token introspection</code>, <code>token revocation</code> requests</li>
<li>Parse responses, validate id_token</li>
<li>Registering new clients using the <code>register</code> endpoint if any</li>
<li>Sending signed and or encrypted requests in the <code>auth</code> and <code>token</code> endpoints</li>
</ul>
<h2>Return values</h2>
<p>Lots of functions in Rhonabwy library return an int value. The returned value can be one of the following:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define I_OK                 0</span></div><div class="line"><span class="preprocessor">#define I_ERROR              1</span></div><div class="line"><span class="preprocessor">#define I_ERROR_PARAM        2</span></div><div class="line"><span class="preprocessor">#define I_ERROR_MEMORY       3</span></div><div class="line"><span class="preprocessor">#define I_ERROR_UNAUTHORIZED 4</span></div><div class="line"><span class="preprocessor">#define I_ERROR_SERVER       5</span></div></div><!-- fragment --><p>If a function is successful, it will return <code>I_OK</code> (0), otherwise an error code is returned.</p>
<h2>Global init and close</h2>
<p>It's <b>recommended</b> to use <code>i_global_init</code> and <code>i_global_close</code> at the beginning and at the end of your program to initialize and cleanup internal values and settings. This will make outgoing requests faster, especially if you use lots of them, and dispatch your memory allocation functions in curl and Jansson if you changed them. These functions are <b>NOT</b> thread-safe, so you must use them in a single thread context.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__core.html#ga74a3452a89fef139072602162847ae49">i_global_init</a>();</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core.html#gac94619aa9efbbe5ca77e2e5d7908ec18">i_global_close</a>();</div></div><!-- fragment --><h2>Log messages</h2>
<p>Usually, a log message is displayed to explain more specifically what happened on error. The log manager used is <a href="https://github.com/babelouest/yder">Yder</a>. You can enable Yder log messages on the console with the following command at the beginning of your program:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main() {</div><div class="line">  y_init_logs(<span class="stringliteral">&quot;Iddawc&quot;</span>, Y_LOG_MODE_CONSOLE, Y_LOG_LEVEL_DEBUG, NULL, <span class="stringliteral">&quot;Starting Iddawc client program&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Do your code here</span></div><div class="line"></div><div class="line">  y_close_logs();</div><div class="line">}</div></div><!-- fragment --><p>Example of an error log message:</p>
<div class="fragment"><div class="line">2020-04-05T16:14:31 - Iddawc: i_run_auth_request - Unsupported auth_method</div></div><!-- fragment --><p>Go to Yder <a href="https://babelouest.github.io/yder/">API Documentation</a> for more details.</p>
<h2>Core functions and struct <a class="el" href="struct__i__session.html">_i_session</a> * variables</h2>
<p>Iddawc is based in the <code>struct <a class="el" href="struct__i__session.html">_i_session</a></code> to store all the required parameters and results to work. You must use the init and clean functions before using a <code>struct <a class="el" href="struct__i__session.html">_i_session</a> *</code> and after finishing using it.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__core.html#ga43fa354058e5ebc2c4d02ef3e9e62687">i_init_session</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core.html#ga6a2fefde91c578c8c2f6b0297e3ee058">i_clean_session</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div></div><!-- fragment --><h3>Get or set properties</h3>
<p>To set or get parameters stored in the <code>struct <a class="el" href="struct__i__session.html">_i_session</a> *</code>, you must use the appropriate function</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#gac73af3a30935b4443af9e86abb1d9fcf">i_set_response_type</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, uint i_value);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#ga6acf44054500b1feb50f42dc55ea6bbb">i_set_result</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, uint i_value);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#ga3c2d963220d4c57407bddce10f3346ab">i_set_int_parameter</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <a class="code" href="group__const.html#ga845a2122b22dd4f5a7f66c7d3bce2b41">i_option</a> option, uint i_value);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#gaca03f2b84e151b70e2ef1c06dda088b7">i_set_str_parameter</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <a class="code" href="group__const.html#ga845a2122b22dd4f5a7f66c7d3bce2b41">i_option</a> option, <span class="keyword">const</span> <span class="keywordtype">char</span> * s_value);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#ga1ae5ceaf789edcc3826b94d22460ea36">i_set_additional_parameter</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * s_key, <span class="keyword">const</span> <span class="keywordtype">char</span> * s_value);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#gae80f8aac03211943b854c3aede3fee6b">i_set_additional_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * s_key, <span class="keyword">const</span> <span class="keywordtype">char</span> * s_value);</div><div class="line"></div><div class="line">uint <a class="code" href="group__properties.html#ga8ec512e6c051ca609bb506be8e0646bc">i_get_response_type</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div><div class="line"></div><div class="line">uint <a class="code" href="group__properties.html#ga110fe3fcde671327f9c787049208a3f2">i_get_result</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div><div class="line"></div><div class="line">uint <a class="code" href="group__properties.html#ga05ae745e994781e3ebaef24321d2eed8">i_get_int_parameter</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <a class="code" href="group__const.html#ga845a2122b22dd4f5a7f66c7d3bce2b41">i_option</a> option);</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="group__properties.html#ga767fdb64638f3dfeb307543e3e8ce22e">i_get_str_parameter</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <a class="code" href="group__const.html#ga845a2122b22dd4f5a7f66c7d3bce2b41">i_option</a> option);</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="group__properties.html#ga66e2e3a7c63f92eb6bd60553ebe5f0c9">i_get_additional_parameter</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * s_key);</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="group__properties.html#ga72f1f165ce3101bb70be9cb007a6f6ad">i_get_additional_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * s_key);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#gaf8548115efbed52436735732aedbdeb7">i_set_rich_authorization_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * type, <span class="keyword">const</span> <span class="keywordtype">char</span> * value);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#ga80aeeac90937c44af74f496802517dc8">i_remove_rich_authorization_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * type);</div><div class="line"></div><div class="line"><span class="keywordtype">char</span> * <a class="code" href="group__properties.html#ga50350be2d2bde7552dd15191d3dc0561">i_get_rich_authorization_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * type);</div></div><!-- fragment --><h3>Import or export sessions</h3>
<p>Iddawc supports importing or exporting <code>struct <a class="el" href="struct__i__session.html">_i_session</a> *</code>. The export format is <code>JSON</code>. Be careful, the JSON output is unsecured and contains all secrets and tokens without encryption!</p>
<p>You can import and export either in <code>json_t *</code> or <code>char *</code>, the <code>char *</code> format is a JSON stringified.</p>
<div class="fragment"><div class="line"></div><div class="line">json_t * <a class="code" href="group__properties.html#ga6a91e08727240c3ccd774fa9eb97e520">i_export_session_json_t</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#ga3a54d6a22fa5a12f929d4b0b6b7afb23">i_import_session_json_t</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, json_t * j_import);</div><div class="line"></div><div class="line"><span class="keywordtype">char</span> * <a class="code" href="group__properties.html#ga3433e1250a1b8b356b9f0c80a456a1b7">i_export_session_str</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#gaa45189c5e0c9cf9c53130973a9c7901a">i_import_session_str</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * str_import);</div></div><!-- fragment --><h2>Run OAuth2 or OIDC requests</h2>
<p>Finally, to run OAuth2 or OIDC requests, you must use the dedicated functions using the initialized and set <code>struct <a class="el" href="struct__i__session.html">_i_session</a> *</code> and some additional parameters if required.</p>
<h3>Load openid-config</h3>
<p>When available, you can load the Openid Config endpoint. This will parse the result and fill the <code>struct <a class="el" href="struct__i__session.html">_i_session</a> *</code> parameters with all the required results (auth endpoint, public keys, signature algorithms, etc.). Using this function required to have set the property <code>I_OPT_OPENID_CONFIG_ENDPOINT</code>.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#gaf719b590f20f10e11ecf36d803f0ac6f">i_load_openid_config</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div></div><!-- fragment --><h3>Build and run auth request and parse results</h3>
<p>The function <code>i_build_auth_url_get</code> can be used to build the full auth request with all the parameters in the URL query for a GET request.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga1a31bc20153cb660fe8224563cd96bb1">i_build_auth_url_get</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div></div><!-- fragment --><p>The function <code>i_run_auth_request</code> builds the full auth requests and executes it. If the OAuth2 server answers with a successful response, the response will be parsed in the session properties. Otherwise, the redirect_to value and the errors if any will be parsed and made available in the session properties.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga2db60e3de3bb62e5cbfc114f1c8449db">i_run_auth_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div></div><!-- fragment --><p>If the auth request is executed by an external program such as the browser, you can parse the redirect_to response afterwards using this function. You must set the <code>I_OPT_REDIRECT_TO</code>.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#gab1b1b471252ea5d5e5311edc75e0cd6f">i_parse_redirect_to</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div></div><!-- fragment --><h3>Build and run device authorization requests and parse results</h3>
<p>If you need to run a device authorization request, you need to use the response type <code>I_RESPONSE_TYPE_DEVICE_CODE</code> and use the function <code>i_run_device_auth_request</code>, the parameter <code>I_OPT_DEVICE_AUTHORIZATION_ENDPOINT</code> must be set. On success, the parameters <code>I_OPT_DEVICE_AUTH_CODE</code>, <code>I_OPT_DEVICE_AUTH_USER_CODE</code>, <code>I_OPT_DEVICE_AUTH_VERIFICATION_URI</code>, <code>I_OPT_DEVICE_AUTH_VERIFICATION_URI_COMPLETE</code>, <code>I_OPT_DEVICE_AUTH_EXPIRES_IN</code> and <code>I_OPT_DEVICE_AUTH_INTERVAL</code> will be set. After that, you'll need to run <code>i_run_token_request</code> (see below) every few seconds until you get a success or a definitive error.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga4e3a4d733768fb210ef2dc7bca49c1d2">i_run_device_auth_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div></div><!-- fragment --><h3>Build and run pushed authorization requests and parse results</h3>
<p>If you need to run a device authorization request, you need to use the function <code>i_run_par_request</code>, and the other parameters as if the request was a normal <code>auth</code> request (<code>response_type</code>, <code>client_id</code>, <code>scope</code>, <code>redirect_uri</code>, authenticaiton type, etc.). On success, the parameters <code>I_OPT_PUSHED_AUTH_REQ_URI</code> and <code>I_OPT_PUSHED_AUTH_REQ_EXPIRES_IN</code> will be automatically set. Then the function <code>i_build_auth_url_get</code> will build an auth url using the request_uri and client_id parameters only.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#gae33a5d87add6949222d96c861ff67fba">i_run_par_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div></div><!-- fragment --><h3>Build and run token requests and parse results</h3>
<p>If you need to execute a request in the token endpoint, to get a refresh token from a code or refresh a token for example,</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#gaf251643a2384c854091a2df0314aac8e">i_run_token_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div></div><!-- fragment --><h3>Verify an id_token</h3>
<p>If the auth or token endpoints returns an id_token, this one will be parsed, the signature will be verified and the content will be validated to make sure the id_token is valid. You can also manually validate an id_token using the dedicated function. The property <code>I_OPT_ID_TOKEN</code> and the public key property must be set.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga625e48c5675c530f8612bd91526a1847">i_verify_id_token</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div></div><!-- fragment --><h3>Load userinfo</h3>
<p>If an access_token is available, you can make a request to the userinfo endpoint to get information about the user. The function <code>i_load_userinfo_custom</code> is a more advanced userinfo request where you can specify query or header parameters, to request more claims or the result a signed JWT.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga71428e3bcc19f2ae742c8fe36e5428b7">i_load_userinfo</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga290ed5c2e464ae32e423c21c00765d8e">i_load_userinfo_custom</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * http_method, <span class="keyword">struct</span> _u_map * additional_query, <span class="keyword">struct</span> _u_map * additional_headers);</div></div><!-- fragment --><h3>Introspect or revoke tokens</h3>
<p>To execute introspection or revocation requests, you must set the session property <code>I_OPT_TOKEN_TARGET</code> and <code>I_OPT_TOKEN_TARGET_TYPE_HINT</code> if required.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#gaf950f7340cb07382ee8dcb2e2d9b86f3">i_introspect_token</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, json_t ** j_result);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga418b5be2b1d81f405a5602d9b865b82c">i_revoke_token</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div></div><!-- fragment --><h3>Register new clients</h3>
<p>If available, you can register a new client. You may have to set a <code>I_OPT_ACCESS_TOKEN</code> property, depending on the server configuration. If <code>update_session</code> is true and the registration is successful, the properties <code>I_OPT_CLIENT_ID</code> and <code>I_OPT_CLIENT_SECRET</code> will be set to the session, and the first <code>redirect_to</code> entry will be used as <code>I_OPT_REDIRECT_TO</code> value.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#gae4b42399eedec1b1a73eaea95c22ce51">i_register_client</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, json_t * j_parameters, <span class="keywordtype">int</span> update_session, json_t ** j_result);</div></div><!-- fragment --><h3>Generate a DPoP token</h3>
<p>You can use your client's private key parameters to generate a DPoP token</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="keywordtype">char</span> * <a class="code" href="group__run.html#ga4276d0948b5f70cc6fed9c4c177d119d">i_generate_dpop_token</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * htm, <span class="keyword">const</span> <span class="keywordtype">char</span> * htu, time_t iat);</div></div><!-- fragment --><h3>Perform a HTTP request to a Resource Service</h3>
<p>This features uses Ulfius' <code>ulfius_send_http_request</code> function to proceed. This function requires at least a <code>struct _u_request</code> with all the request parameters. Iddawc will add the access token previously obtained to the HTTP request using the <a href="https://tools.ietf.org/html/rfc6750">Bearer usage</a> specified. If the access token is expired, Iddawc will attempt to refresh the token. If specified, Iddawc will generate and add a DPoP token in the request using the request parameters.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga069cc2c92fee719ee529c22a5eb93653">i_perform_api_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">struct</span> _u_request * http_request, <span class="keyword">struct</span> _u_response * http_response, <span class="keywordtype">int</span> refresh_if_expired, <span class="keywordtype">int</span> bearer_type, <span class="keywordtype">int</span> use_dpop, time_t dpop_iat);</div></div><!-- fragment --><p>Here is an example of how to use <code>i_perform_api_request</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct__i__session.html">_i_session</a> i_session;</div><div class="line"><span class="keyword">struct </span>_u_request req;</div><div class="line"><span class="keyword">struct </span>_u_response resp;</div><div class="line">json_t * j_resp;</div><div class="line"></div><div class="line"><a class="code" href="group__core.html#ga43fa354058e5ebc2c4d02ef3e9e62687">i_init_session</a>(&amp;i_session);</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * All the process to get an access token is hidden, this example considers the _i_session has an access token</span></div><div class="line"><span class="comment"> */</span></div><div class="line">ulfius_init_request(&amp;req);</div><div class="line">ulfius_init_response(&amp;resp);</div><div class="line"></div><div class="line">ulfius_set_request_properties(&amp;req, U_OPT_HTTP_VERB, <span class="stringliteral">&quot;GET&quot;</span>, U_OPT_HTTP_URL, <span class="stringliteral">&quot;https://resource.tld/object&quot;</span>, U_OPT_NONE);</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__run.html#ga069cc2c92fee719ee529c22a5eb93653">i_perform_api_request</a>(&amp;i_session, &amp;req, &amp;resp, 1, <a class="code" href="group__const.html#ga31a37a18a330e9643b08a380aecfc4f2">I_BEARER_TYPE_HEADER</a>, 1, 0) == <a class="code" href="group__const.html#gac3e719888cb77e5de100927c5697a4ec">I_OK</a> &amp;&amp; resp.status == 200) {</div><div class="line">  <span class="comment">// j_resp contains the JSON response of the protected resource</span></div><div class="line">  j_resp = ulfius_get_json_body_response(&amp;resp, NULL);</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="group__core.html#ga6a2fefde91c578c8c2f6b0297e3ee058">i_clean_session</a>(&amp;i_session);</div><div class="line">ulfius_clean_request(&amp;req);</div><div class="line">ulfius_clean_response(&amp;resp);</div><div class="line">json_decref(j_resp);</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
