<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Iddawc: Iddawc API documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Iddawc
   </div>
   <div id="projectbrief">Handle the flow of OAuth2 and OpenID Connect authentication process from the client side.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Iddawc API documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_API"></a> Iddawc is a C library used to implement OAuth2/OIDC clients according to the <a href="https://tools.ietf.org/html/rfc6749">OAuth2 RFC</a> and the <a href="https://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Specs</a>.</p>
<p>It's based on <a href="https://github.com/babelouest/ulfius">Ulfius</a> library for the HTTP requests and response management and <a href="https://github.com/babelouest/rhonabwy">Rhonabwy</a> library for the JOSE management.</p>
<p>Iddawc supports the following features:</p>
<ul>
<li>Loading openid-configuration endpoints and parsing the results</li>
<li>Making <code>auth</code> requests using the given parameters (<code>client_id</code>, <code>client_secret</code>, <code>redirect_uri</code>, etc.) and parsing the result</li>
<li>Making <code>token</code> requests using the given parameters (<code>code</code>, <code>client_id</code>, <code>client_secret</code>, <code>redirect_uri</code>, etc.) and parsing the result</li>
<li>Making <code>userinfo</code>, <code>token introspection</code>, <code>token revocation</code> requests</li>
<li>Parse responses, validate id_token</li>
<li>Registering new clients using the <code>register</code> endpoint if any</li>
<li>Sending signed and or encrypted requests in the <code>auth</code> and <code>token</code> endpoints</li>
<li>Client TLS Authentication available</li>
<li>Making Pushed Auth Requests</li>
<li>Making Rich Auth Requests</li>
<li>Adding claims to requests</li>
<li>Sending DPoP proofs</li>
<li>JWT Secured Authorization Response Mode</li>
<li>End session and single-logout functionalities</li>
</ul>
<h1>Return values</h1>
<p>Lots of functions in Rhonabwy library return an int value. The returned value can be one of the following:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define I_OK                 0</span></div>
<div class="line"><span class="preprocessor">#define I_ERROR              1</span></div>
<div class="line"><span class="preprocessor">#define I_ERROR_PARAM        2</span></div>
<div class="line"><span class="preprocessor">#define I_ERROR_MEMORY       3</span></div>
<div class="line"><span class="preprocessor">#define I_ERROR_UNAUTHORIZED 4</span></div>
<div class="line"><span class="preprocessor">#define I_ERROR_SERVER       5</span></div>
</div><!-- fragment --><p>If a function is successful, it will return <code>I_OK</code> (0), otherwise an error code is returned.</p>
<h1>Global init and close</h1>
<p>It's <b>recommended</b> to use <code>i_global_init</code> and <code>i_global_close</code> at the beginning and at the end of your program to initialize and cleanup internal values and settings. This will make outgoing requests faster, especially if you use lots of them, and dispatch your memory allocation functions in curl and Jansson if you changed them. These functions are <b>NOT</b> thread-safe, so you must use them in a single thread context.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__core.html#ga74a3452a89fef139072602162847ae49">i_global_init</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core.html#gac94619aa9efbbe5ca77e2e5d7908ec18">i_global_close</a>();</div>
<div class="ttc" id="agroup__core_html_ga74a3452a89fef139072602162847ae49"><div class="ttname"><a href="group__core.html#ga74a3452a89fef139072602162847ae49">i_global_init</a></div><div class="ttdeci">int i_global_init()</div><div class="ttdef"><b>Definition:</b> iddawc.c:1417</div></div>
<div class="ttc" id="agroup__core_html_gac94619aa9efbbe5ca77e2e5d7908ec18"><div class="ttname"><a href="group__core.html#gac94619aa9efbbe5ca77e2e5d7908ec18">i_global_close</a></div><div class="ttdeci">void i_global_close()</div><div class="ttdef"><b>Definition:</b> iddawc.c:1426</div></div>
</div><!-- fragment --><h1>Log messages</h1>
<p>Usually, a log message is displayed to explain more specifically what happened on error. The log manager used is <a href="https://github.com/babelouest/yder">Yder</a>. You can enable Yder log messages on the console with the following command at the beginning of your program:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  y_init_logs(<span class="stringliteral">&quot;Iddawc&quot;</span>, Y_LOG_MODE_CONSOLE, Y_LOG_LEVEL_DEBUG, NULL, <span class="stringliteral">&quot;Starting Iddawc client program&quot;</span>);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Do your code here</span></div>
<div class="line">  </div>
<div class="line">  y_close_logs();</div>
<div class="line">}</div>
</div><!-- fragment --><p>Example of an error log message:</p>
<div class="fragment"><div class="line">2020-04-05T16:14:31 - Iddawc: i_run_auth_request - Unsupported auth_method</div>
</div><!-- fragment --><p>Go to Yder <a href="https://babelouest.github.io/yder/">API Documentation</a> for more details.</p>
<h1>Core functions and struct <a class="el" href="struct__i__session.html">_i_session</a> * variables</h1>
<p>Iddawc is based in the <code>struct <a class="el" href="struct__i__session.html">_i_session</a></code> to store all the required parameters and results to work. You must use the init and clean functions before using a <code>struct <a class="el" href="struct__i__session.html">_i_session</a> *</code> and after finishing using it.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__core.html#ga43fa354058e5ebc2c4d02ef3e9e62687">i_init_session</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core.html#ga6a2fefde91c578c8c2f6b0297e3ee058">i_clean_session</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div>
<div class="ttc" id="agroup__core_html_ga43fa354058e5ebc2c4d02ef3e9e62687"><div class="ttname"><a href="group__core.html#ga43fa354058e5ebc2c4d02ef3e9e62687">i_init_session</a></div><div class="ttdeci">int i_init_session(struct _i_session *i_session)</div><div class="ttdef"><b>Definition:</b> iddawc.c:1435</div></div>
<div class="ttc" id="agroup__core_html_ga6a2fefde91c578c8c2f6b0297e3ee058"><div class="ttname"><a href="group__core.html#ga6a2fefde91c578c8c2f6b0297e3ee058">i_clean_session</a></div><div class="ttdeci">void i_clean_session(struct _i_session *i_session)</div><div class="ttdef"><b>Definition:</b> iddawc.c:1587</div></div>
<div class="ttc" id="astruct__i__session_html"><div class="ttname"><a href="struct__i__session.html">_i_session</a></div><div class="ttdef"><b>Definition:</b> iddawc.h:267</div></div>
</div><!-- fragment --><h2>Get or set properties</h2>
<p>To set or get parameters stored in the <code>struct <a class="el" href="struct__i__session.html">_i_session</a> *</code>, you must use the appropriate function</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#gac73af3a30935b4443af9e86abb1d9fcf">i_set_response_type</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, uint i_value);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#ga6acf44054500b1feb50f42dc55ea6bbb">i_set_result</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, uint i_value);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#ga3c2d963220d4c57407bddce10f3346ab">i_set_int_parameter</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <a class="code" href="group__const.html#ga845a2122b22dd4f5a7f66c7d3bce2b41">i_option</a> option, uint i_value);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#gaca03f2b84e151b70e2ef1c06dda088b7">i_set_str_parameter</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <a class="code" href="group__const.html#ga845a2122b22dd4f5a7f66c7d3bce2b41">i_option</a> option, <span class="keyword">const</span> <span class="keywordtype">char</span> * s_value);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#ga1ae5ceaf789edcc3826b94d22460ea36">i_set_additional_parameter</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * s_key, <span class="keyword">const</span> <span class="keywordtype">char</span> * s_value);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#gae80f8aac03211943b854c3aede3fee6b">i_set_additional_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * s_key, <span class="keyword">const</span> <span class="keywordtype">char</span> * s_value);</div>
<div class="line"> </div>
<div class="line">uint <a class="code" href="group__properties.html#ga8ec512e6c051ca609bb506be8e0646bc">i_get_response_type</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div>
<div class="line"> </div>
<div class="line">uint <a class="code" href="group__properties.html#ga110fe3fcde671327f9c787049208a3f2">i_get_result</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div>
<div class="line"> </div>
<div class="line">uint <a class="code" href="group__properties.html#ga05ae745e994781e3ebaef24321d2eed8">i_get_int_parameter</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <a class="code" href="group__const.html#ga845a2122b22dd4f5a7f66c7d3bce2b41">i_option</a> option);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="group__properties.html#ga767fdb64638f3dfeb307543e3e8ce22e">i_get_str_parameter</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <a class="code" href="group__const.html#ga845a2122b22dd4f5a7f66c7d3bce2b41">i_option</a> option);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="group__properties.html#ga66e2e3a7c63f92eb6bd60553ebe5f0c9">i_get_additional_parameter</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * s_key);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="group__properties.html#ga72f1f165ce3101bb70be9cb007a6f6ad">i_get_additional_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * s_key);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> i_set_rich_authorization_request(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * type, <span class="keyword">const</span> <span class="keywordtype">char</span> * value);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#ga80aeeac90937c44af74f496802517dc8">i_remove_rich_authorization_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * type);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> * i_get_rich_authorization_request(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * type);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#ga74f0a21ec2933521d50a93062a2ff522">i_set_parameter_list</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, ...);</div>
<div class="ttc" id="agroup__const_html_ga845a2122b22dd4f5a7f66c7d3bce2b41"><div class="ttname"><a href="group__const.html#ga845a2122b22dd4f5a7f66c7d3bce2b41">i_option</a></div><div class="ttdeci">i_option</div><div class="ttdef"><b>Definition:</b> iddawc.h:135</div></div>
<div class="ttc" id="agroup__properties_html_ga05ae745e994781e3ebaef24321d2eed8"><div class="ttname"><a href="group__properties.html#ga05ae745e994781e3ebaef24321d2eed8">i_get_int_parameter</a></div><div class="ttdeci">uint i_get_int_parameter(struct _i_session *i_session, i_option option)</div><div class="ttdef"><b>Definition:</b> iddawc.c:2989</div></div>
<div class="ttc" id="agroup__properties_html_ga110fe3fcde671327f9c787049208a3f2"><div class="ttname"><a href="group__properties.html#ga110fe3fcde671327f9c787049208a3f2">i_get_result</a></div><div class="ttdeci">uint i_get_result(struct _i_session *i_session)</div><div class="ttdef"><b>Definition:</b> iddawc.c:2985</div></div>
<div class="ttc" id="agroup__properties_html_ga1ae5ceaf789edcc3826b94d22460ea36"><div class="ttname"><a href="group__properties.html#ga1ae5ceaf789edcc3826b94d22460ea36">i_set_additional_parameter</a></div><div class="ttdeci">int i_set_additional_parameter(struct _i_session *i_session, const char *s_key, const char *s_value)</div><div class="ttdef"><b>Definition:</b> iddawc.c:2551</div></div>
<div class="ttc" id="agroup__properties_html_ga3c2d963220d4c57407bddce10f3346ab"><div class="ttname"><a href="group__properties.html#ga3c2d963220d4c57407bddce10f3346ab">i_set_int_parameter</a></div><div class="ttdeci">int i_set_int_parameter(struct _i_session *i_session, i_option option, uint i_value)</div><div class="ttdef"><b>Definition:</b> iddawc.c:1667</div></div>
<div class="ttc" id="agroup__properties_html_ga66e2e3a7c63f92eb6bd60553ebe5f0c9"><div class="ttname"><a href="group__properties.html#ga66e2e3a7c63f92eb6bd60553ebe5f0c9">i_get_additional_parameter</a></div><div class="ttdeci">const char * i_get_additional_parameter(struct _i_session *i_session, const char *s_key)</div><div class="ttdef"><b>Definition:</b> iddawc.c:3420</div></div>
<div class="ttc" id="agroup__properties_html_ga6acf44054500b1feb50f42dc55ea6bbb"><div class="ttname"><a href="group__properties.html#ga6acf44054500b1feb50f42dc55ea6bbb">i_set_result</a></div><div class="ttdeci">int i_set_result(struct _i_session *i_session, uint i_value)</div><div class="ttdef"><b>Definition:</b> iddawc.c:1663</div></div>
<div class="ttc" id="agroup__properties_html_ga72f1f165ce3101bb70be9cb007a6f6ad"><div class="ttname"><a href="group__properties.html#ga72f1f165ce3101bb70be9cb007a6f6ad">i_get_additional_response</a></div><div class="ttdeci">const char * i_get_additional_response(struct _i_session *i_session, const char *s_key)</div><div class="ttdef"><b>Definition:</b> iddawc.c:3428</div></div>
<div class="ttc" id="agroup__properties_html_ga74f0a21ec2933521d50a93062a2ff522"><div class="ttname"><a href="group__properties.html#ga74f0a21ec2933521d50a93062a2ff522">i_set_parameter_list</a></div><div class="ttdeci">int i_set_parameter_list(struct _i_session *i_session,...)</div><div class="ttdef"><b>Definition:</b> iddawc.c:2651</div></div>
<div class="ttc" id="agroup__properties_html_ga767fdb64638f3dfeb307543e3e8ce22e"><div class="ttname"><a href="group__properties.html#ga767fdb64638f3dfeb307543e3e8ce22e">i_get_str_parameter</a></div><div class="ttdeci">const char * i_get_str_parameter(struct _i_session *i_session, i_option option)</div><div class="ttdef"><b>Definition:</b> iddawc.c:3156</div></div>
<div class="ttc" id="agroup__properties_html_ga80aeeac90937c44af74f496802517dc8"><div class="ttname"><a href="group__properties.html#ga80aeeac90937c44af74f496802517dc8">i_remove_rich_authorization_request</a></div><div class="ttdeci">int i_remove_rich_authorization_request(struct _i_session *i_session, const char *type)</div><div class="ttdef"><b>Definition:</b> iddawc.c:5912</div></div>
<div class="ttc" id="agroup__properties_html_ga8ec512e6c051ca609bb506be8e0646bc"><div class="ttname"><a href="group__properties.html#ga8ec512e6c051ca609bb506be8e0646bc">i_get_response_type</a></div><div class="ttdeci">uint i_get_response_type(struct _i_session *i_session)</div><div class="ttdef"><b>Definition:</b> iddawc.c:2981</div></div>
<div class="ttc" id="agroup__properties_html_gac73af3a30935b4443af9e86abb1d9fcf"><div class="ttname"><a href="group__properties.html#gac73af3a30935b4443af9e86abb1d9fcf">i_set_response_type</a></div><div class="ttdeci">int i_set_response_type(struct _i_session *i_session, uint i_value)</div><div class="ttdef"><b>Definition:</b> iddawc.c:1659</div></div>
<div class="ttc" id="agroup__properties_html_gaca03f2b84e151b70e2ef1c06dda088b7"><div class="ttname"><a href="group__properties.html#gaca03f2b84e151b70e2ef1c06dda088b7">i_set_str_parameter</a></div><div class="ttdeci">int i_set_str_parameter(struct _i_session *i_session, i_option option, const char *s_value)</div><div class="ttdef"><b>Definition:</b> iddawc.c:1854</div></div>
<div class="ttc" id="agroup__properties_html_gae80f8aac03211943b854c3aede3fee6b"><div class="ttname"><a href="group__properties.html#gae80f8aac03211943b854c3aede3fee6b">i_set_additional_response</a></div><div class="ttdeci">int i_set_additional_response(struct _i_session *i_session, const char *s_key, const char *s_value)</div><div class="ttdef"><b>Definition:</b> iddawc.c:2563</div></div>
</div><!-- fragment --><h2>Import or export sessions</h2>
<p>Iddawc supports importing or exporting <code>struct <a class="el" href="struct__i__session.html">_i_session</a> *</code>. The export format is <code>JSON</code>. Be careful, the JSON output is unsecured and contains all secrets and tokens without encryption!</p>
<p>You can import and export either in <code>json_t *</code> or <code>char *</code>, the <code>char *</code> format is a JSON stringified.</p>
<div class="fragment"><div class="line"> </div>
<div class="line">json_t * <a class="code" href="group__properties.html#ga6a91e08727240c3ccd774fa9eb97e520">i_export_session_json_t</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#ga3a54d6a22fa5a12f929d4b0b6b7afb23">i_import_session_json_t</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, json_t * j_import);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> * <a class="code" href="group__properties.html#ga3433e1250a1b8b356b9f0c80a456a1b7">i_export_session_str</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__properties.html#gaa45189c5e0c9cf9c53130973a9c7901a">i_import_session_str</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * str_import);</div>
<div class="ttc" id="agroup__properties_html_ga3433e1250a1b8b356b9f0c80a456a1b7"><div class="ttname"><a href="group__properties.html#ga3433e1250a1b8b356b9f0c80a456a1b7">i_export_session_str</a></div><div class="ttdeci">char * i_export_session_str(struct _i_session *i_session)</div><div class="ttdef"><b>Definition:</b> iddawc.c:5508</div></div>
<div class="ttc" id="agroup__properties_html_ga3a54d6a22fa5a12f929d4b0b6b7afb23"><div class="ttname"><a href="group__properties.html#ga3a54d6a22fa5a12f929d4b0b6b7afb23">i_import_session_json_t</a></div><div class="ttdeci">int i_import_session_json_t(struct _i_session *i_session, json_t *j_import)</div><div class="ttdef"><b>Definition:</b> iddawc.c:5343</div></div>
<div class="ttc" id="agroup__properties_html_ga6a91e08727240c3ccd774fa9eb97e520"><div class="ttname"><a href="group__properties.html#ga6a91e08727240c3ccd774fa9eb97e520">i_export_session_json_t</a></div><div class="ttdeci">json_t * i_export_session_json_t(struct _i_session *i_session)</div><div class="ttdef"><b>Definition:</b> iddawc.c:5189</div></div>
<div class="ttc" id="agroup__properties_html_gaa45189c5e0c9cf9c53130973a9c7901a"><div class="ttname"><a href="group__properties.html#gaa45189c5e0c9cf9c53130973a9c7901a">i_import_session_str</a></div><div class="ttdeci">int i_import_session_str(struct _i_session *i_session, const char *str_import)</div><div class="ttdef"><b>Definition:</b> iddawc.c:5519</div></div>
</div><!-- fragment --><h1>Run OAuth2 or OIDC requests</h1>
<p>Finally, to run OAuth2 or OIDC requests, you must use the dedicated functions using the initialized and set <code>struct <a class="el" href="struct__i__session.html">_i_session</a> *</code> and some additional parameters if required.</p>
<h2>Load openid-config</h2>
<p>When available, you can load the Openid Config endpoint. This will parse the result and fill the <code>struct <a class="el" href="struct__i__session.html">_i_session</a> *</code> parameters with all the required results (auth endpoint, public keys, signature algorithms, etc.). Using this function required to have set the property <code>I_OPT_OPENID_CONFIG_ENDPOINT</code>.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#gaa93fb87ef370ffce18d3713c07947c88">i_get_openid_config</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div>
<div class="ttc" id="agroup__run_html_gaa93fb87ef370ffce18d3713c07947c88"><div class="ttname"><a href="group__run.html#gaa93fb87ef370ffce18d3713c07947c88">i_get_openid_config</a></div><div class="ttdeci">int i_get_openid_config(struct _i_session *i_session)</div><div class="ttdef"><b>Definition:</b> iddawc.c:2806</div></div>
</div><!-- fragment --><h2>Build and run auth request and parse results</h2>
<p>The function <code>i_build_auth_url_get</code> can be used to build the full auth request with all the parameters in the URL query for a GET request.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga1a31bc20153cb660fe8224563cd96bb1">i_build_auth_url_get</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div>
<div class="ttc" id="agroup__run_html_ga1a31bc20153cb660fe8224563cd96bb1"><div class="ttname"><a href="group__run.html#ga1a31bc20153cb660fe8224563cd96bb1">i_build_auth_url_get</a></div><div class="ttdeci">int i_build_auth_url_get(struct _i_session *i_session)</div><div class="ttdef"><b>Definition:</b> iddawc.c:3488</div></div>
</div><!-- fragment --><p>The function <code>i_run_auth_request</code> builds the full auth requests and executes it. If the OAuth2 server answers with a successful response, the response will be parsed in the session properties. Otherwise, the redirect_to value and the errors if any will be parsed and made available in the session properties.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga2db60e3de3bb62e5cbfc114f1c8449db">i_run_auth_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div>
<div class="ttc" id="agroup__run_html_ga2db60e3de3bb62e5cbfc114f1c8449db"><div class="ttname"><a href="group__run.html#ga2db60e3de3bb62e5cbfc114f1c8449db">i_run_auth_request</a></div><div class="ttdeci">int i_run_auth_request(struct _i_session *i_session)</div><div class="ttdef"><b>Definition:</b> iddawc.c:3652</div></div>
</div><!-- fragment --><p>If the auth request is executed by an external program such as the browser, you can parse the redirect_to response afterwards using this function. You must set the <code>I_OPT_REDIRECT_TO</code>.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#gab1b1b471252ea5d5e5311edc75e0cd6f">i_parse_redirect_to</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div>
<div class="ttc" id="agroup__run_html_gab1b1b471252ea5d5e5311edc75e0cd6f"><div class="ttname"><a href="group__run.html#gab1b1b471252ea5d5e5311edc75e0cd6f">i_parse_redirect_to</a></div><div class="ttdeci">int i_parse_redirect_to(struct _i_session *i_session)</div><div class="ttdef"><b>Definition:</b> iddawc.c:3075</div></div>
</div><!-- fragment --><h2>Build and run device authorization requests and parse results</h2>
<p>If you need to run a device authorization request, you need to use the response type <code>I_RESPONSE_TYPE_DEVICE_CODE</code> and use the function <code>i_run_device_auth_request</code>, the parameter <code>I_OPT_DEVICE_AUTHORIZATION_ENDPOINT</code> must be set. On success, the parameters <code>I_OPT_DEVICE_AUTH_CODE</code>, <code>I_OPT_DEVICE_AUTH_USER_CODE</code>, <code>I_OPT_DEVICE_AUTH_VERIFICATION_URI</code>, <code>I_OPT_DEVICE_AUTH_VERIFICATION_URI_COMPLETE</code>, <code>I_OPT_DEVICE_AUTH_EXPIRES_IN</code> and <code>I_OPT_DEVICE_AUTH_INTERVAL</code> will be set. After that, you'll need to run <code>i_run_token_request</code> (see below) every few seconds until you get a success or a definitive error.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga4e3a4d733768fb210ef2dc7bca49c1d2">i_run_device_auth_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div>
<div class="ttc" id="agroup__run_html_ga4e3a4d733768fb210ef2dc7bca49c1d2"><div class="ttname"><a href="group__run.html#ga4e3a4d733768fb210ef2dc7bca49c1d2">i_run_device_auth_request</a></div><div class="ttdeci">int i_run_device_auth_request(struct _i_session *i_session)</div><div class="ttdef"><b>Definition:</b> iddawc.c:5961</div></div>
</div><!-- fragment --><h2>Build and run pushed authorization requests and parse results</h2>
<p>To run a device authorization request, you need to use the function <code>i_run_par_request</code>, and the other parameters as if the request was a normal <code>auth</code> request (<code>response_type</code>, <code>client_id</code>, <code>scope</code>, <code>redirect_uri</code>, authenticaiton type, etc.).</p>
<p>On success, the parameters <code>I_OPT_PUSHED_AUTH_REQ_URI</code> and <code>I_OPT_PUSHED_AUTH_REQ_EXPIRES_IN</code> will be automatically set. Then the function <code>i_build_auth_url_get</code> will build an auth url using the request_uri and client_id parameters only.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#gae33a5d87add6949222d96c861ff67fba">i_run_par_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div>
<div class="ttc" id="agroup__run_html_gae33a5d87add6949222d96c861ff67fba"><div class="ttname"><a href="group__run.html#gae33a5d87add6949222d96c861ff67fba">i_run_par_request</a></div><div class="ttdeci">int i_run_par_request(struct _i_session *i_session)</div><div class="ttdef"><b>Definition:</b> iddawc.c:6062</div></div>
</div><!-- fragment --><h2>Build and run token requests and parse results</h2>
<p>To execute a request in the token endpoint, get a refresh token from a code or refresh a token,</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#gaf251643a2384c854091a2df0314aac8e">i_run_token_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div>
<div class="ttc" id="agroup__run_html_gaf251643a2384c854091a2df0314aac8e"><div class="ttname"><a href="group__run.html#gaf251643a2384c854091a2df0314aac8e">i_run_token_request</a></div><div class="ttdeci">int i_run_token_request(struct _i_session *i_session)</div><div class="ttdef"><b>Definition:</b> iddawc.c:3884</div></div>
</div><!-- fragment --><h2>Verify an id_token</h2>
<p>If the auth or token endpoints returns an id_token, this one will be parsed, the signature will be verified and the content will be validated to make sure the id_token is valid.</p>
<p>You can also manually validate an id_token using the dedicated function. The property <code>I_OPT_ID_TOKEN</code> and the public key property must be set.</p>
<p>When an id_token is validated, its claims are available in the property <code>json_t * struct <a class="el" href="struct__i__session.html#a7c02462f4d96514b8ded5e198de12d95">_i_session.id_token_payload</a></code>.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga625e48c5675c530f8612bd91526a1847">i_verify_id_token</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div>
<div class="ttc" id="agroup__run_html_ga625e48c5675c530f8612bd91526a1847"><div class="ttname"><a href="group__run.html#ga625e48c5675c530f8612bd91526a1847">i_verify_id_token</a></div><div class="ttdeci">int i_verify_id_token(struct _i_session *i_session)</div><div class="ttdef"><b>Definition:</b> iddawc.c:4315</div></div>
</div><!-- fragment --><h2>Verify an access_token</h2>
<p>If the access_token is a JWT, you can use the function <code>i_verify_jwt_access_token</code> to verify its signature and content. The access token must use the format specified in the <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-access-token-jwt-13">JSON Web Token (JWT) Profile for OAuth 2.0 Access Tokens</a> standard.</p>
<p>The function will verify the claims <code>iss</code>, <code>iat</code> and <code>aud</code>.</p>
<p>When an access_token is validated, its claims are available in the property <code>json_t * struct <a class="el" href="struct__i__session.html#a235ef8cc4ed7448257a42d92b2383565">_i_session.access_token_payload</a></code>.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga48852eaa3f90606b904cbe3737a09aab">i_verify_jwt_access_token</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * aud);</div>
<div class="ttc" id="agroup__run_html_ga48852eaa3f90606b904cbe3737a09aab"><div class="ttname"><a href="group__run.html#ga48852eaa3f90606b904cbe3737a09aab">i_verify_jwt_access_token</a></div><div class="ttdeci">int i_verify_jwt_access_token(struct _i_session *i_session, const char *aud)</div><div class="ttdef"><b>Definition:</b> iddawc.c:4474</div></div>
</div><!-- fragment --><h2>Load userinfo</h2>
<p>If an access_token is available, you can make a request to the userinfo endpoint to get information about the user.</p>
<p>The function <code>i_load_userinfo_custom</code> is a more advanced userinfo request where you can specify query or header parameters, to request more claims or the result as a signed JWT.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga4e23ab9e9fadbafe410e85ed743842f9">i_get_userinfo</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keywordtype">int</span> get_jwt);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga45f8e6c84679edeadb9aad1ec8501b4e">i_get_userinfo_custom</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * http_method, <span class="keyword">struct</span> _u_map * additional_query, <span class="keyword">struct</span> _u_map * additional_headers);</div>
<div class="ttc" id="agroup__run_html_ga45f8e6c84679edeadb9aad1ec8501b4e"><div class="ttname"><a href="group__run.html#ga45f8e6c84679edeadb9aad1ec8501b4e">i_get_userinfo_custom</a></div><div class="ttdeci">int i_get_userinfo_custom(struct _i_session *i_session, const char *http_method, struct _u_map *additional_query, struct _u_map *additional_headers)</div><div class="ttdef"><b>Definition:</b> iddawc.c:2867</div></div>
<div class="ttc" id="agroup__run_html_ga4e23ab9e9fadbafe410e85ed743842f9"><div class="ttname"><a href="group__run.html#ga4e23ab9e9fadbafe410e85ed743842f9">i_get_userinfo</a></div><div class="ttdeci">int i_get_userinfo(struct _i_session *i_session, int get_jwt)</div><div class="ttdef"><b>Definition:</b> iddawc.c:2850</div></div>
</div><!-- fragment --><h2>Introspect or revoke tokens</h2>
<p>To execute introspection or revocation requests, you must set the session property <code>I_OPT_TOKEN_TARGET</code> and <code>I_OPT_TOKEN_TARGET_TYPE_HINT</code> if required.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> i_introspect_token(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, json_t ** j_result);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga168ed1f7be1c7a0e41720f29ab44fcd2">i_revoke_token</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div>
<div class="ttc" id="agroup__run_html_ga168ed1f7be1c7a0e41720f29ab44fcd2"><div class="ttname"><a href="group__run.html#ga168ed1f7be1c7a0e41720f29ab44fcd2">i_revoke_token</a></div><div class="ttdeci">int i_revoke_token(struct _i_session *i_session, int authentication)</div><div class="ttdef"><b>Definition:</b> iddawc.c:4516</div></div>
</div><!-- fragment --><h2>Register new clients</h2>
<p>You can register a new client using this dedicated functions.</p>
<p>You may have to set a <code>I_OPT_ACCESS_TOKEN</code> property, depending on the server configuration. If <code>update_session</code> is true and the registration is successful, the properties <code>I_OPT_CLIENT_ID</code> and <code>I_OPT_CLIENT_SECRET</code> will be set to the session, and the first <code>redirect_to</code> entry will be used as <code>I_OPT_REDIRECT_TO</code> value.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#gae4b42399eedec1b1a73eaea95c22ce51">i_register_client</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, json_t * j_parameters, <span class="keywordtype">int</span> update_session, json_t ** j_result);</div>
<div class="ttc" id="agroup__run_html_gae4b42399eedec1b1a73eaea95c22ce51"><div class="ttname"><a href="group__run.html#gae4b42399eedec1b1a73eaea95c22ce51">i_register_client</a></div><div class="ttdeci">int i_register_client(struct _i_session *i_session, json_t *j_parameters, int update_session, json_t **j_result)</div><div class="ttdef"><b>Definition:</b> iddawc.c:4774</div></div>
</div><!-- fragment --><h2>Manage clients registration</h2>
<p>You can manage a client registration by changing its metadata or get the client registration metadata. These functions will use the access_token in the session if one is set.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#gad361385c6da3d496994306ec5b37b37e">i_manage_registration_client</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, json_t * j_parameters, <span class="keywordtype">int</span> update_session, json_t ** j_result);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga5d47fb47d1fea0aaecbd8da8e2230654">i_get_registration_client</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, json_t ** j_result);</div>
<div class="ttc" id="agroup__run_html_ga5d47fb47d1fea0aaecbd8da8e2230654"><div class="ttname"><a href="group__run.html#ga5d47fb47d1fea0aaecbd8da8e2230654">i_get_registration_client</a></div><div class="ttdeci">int i_get_registration_client(struct _i_session *i_session, json_t **j_result)</div><div class="ttdef"><b>Definition:</b> iddawc.c:4950</div></div>
<div class="ttc" id="agroup__run_html_gad361385c6da3d496994306ec5b37b37e"><div class="ttname"><a href="group__run.html#gad361385c6da3d496994306ec5b37b37e">i_manage_registration_client</a></div><div class="ttdeci">int i_manage_registration_client(struct _i_session *i_session, json_t *j_parameters, int update_session, json_t **j_result)</div><div class="ttdef"><b>Definition:</b> iddawc.c:5019</div></div>
</div><!-- fragment --><h2>Generate a DPoP token</h2>
<p>You can use your client's private key parameters to generate a DPoP token. If you set the session property <code>I_OPT_USE_DPOP</code> to true, the functions <code>i_run_device_auth_request</code>, <code>i_run_par_request</code>, <code>i_get_userinfo_custom</code>, <code>i_get_userinfo</code>, <code>i_run_token_request</code>, <code>i_revoke_token</code>, <code>i_get_token_introspection</code> or <code>i_perform_resource_service_request</code> will add a DPoP header.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> * <a class="code" href="group__run.html#ga525029dc9d7979066f020c0d51ef3b93">i_generate_dpop_token</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * htm, <span class="keyword">const</span> <span class="keywordtype">char</span> * htu, time_t iat, <span class="keywordtype">int</span> add_ath);</div>
<div class="ttc" id="agroup__run_html_ga525029dc9d7979066f020c0d51ef3b93"><div class="ttname"><a href="group__run.html#ga525029dc9d7979066f020c0d51ef3b93">i_generate_dpop_token</a></div><div class="ttdeci">char * i_generate_dpop_token(struct _i_session *i_session, const char *htm, const char *htu, time_t iat, int add_ath)</div><div class="ttdef"><b>Definition:</b> iddawc.c:5537</div></div>
</div><!-- fragment --><h2>Verify a DPoP proof</h2>
<p>If you are using Iddawc in a Resource Service (RS), you can check the DPoP sent by the client using the function <code>i_verify_dpop_proof</code>. The parameter <code>const char * access_token</code> is mandatory to comply with DPoP Definition, Draft 04.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#gac96c00e3cd99b7c00c49fa46b3d23559">i_verify_dpop_proof</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * dpop_header, <span class="keyword">const</span> <span class="keywordtype">char</span> * htm, <span class="keyword">const</span> <span class="keywordtype">char</span> * htu, time_t max_iat, <span class="keyword">const</span> <span class="keywordtype">char</span> * jkt, <span class="keyword">const</span> <span class="keywordtype">char</span> * access_token);</div>
<div class="ttc" id="agroup__run_html_gac96c00e3cd99b7c00c49fa46b3d23559"><div class="ttname"><a href="group__run.html#gac96c00e3cd99b7c00c49fa46b3d23559">i_verify_dpop_proof</a></div><div class="ttdeci">int i_verify_dpop_proof(const char *dpop_header, const char *htm, const char *htu, time_t max_iat, const char *jkt, const char *access_token)</div><div class="ttdef"><b>Definition:</b> iddawc.c:5739</div></div>
</div><!-- fragment --><h2>Perform a HTTP request to a Resource Service</h2>
<p>This features uses Ulfius' <code>ulfius_send_http_request</code> function to proceed. This function requires at least a <code>struct _u_request</code> with all the request parameters.</p>
<p>Iddawc will add the access token previously obtained to the HTTP request using the <a href="https://tools.ietf.org/html/rfc6750">Bearer usage</a> specified.</p>
<p>If the access token is expired, Iddawc will attempt to refresh the token.</p>
<p>If specified, Iddawc will generate and add a DPoP token in the request using the request parameters.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga287c866466f6b7ed0beea1854f72b0e2">i_perform_resource_service_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">struct</span> _u_request * http_request, <span class="keyword">struct</span> _u_response * http_response, <span class="keywordtype">int</span> refresh_if_expired, <span class="keywordtype">int</span> bearer_type, <span class="keywordtype">int</span> use_dpop, time_t dpop_iat);</div>
<div class="ttc" id="agroup__run_html_ga287c866466f6b7ed0beea1854f72b0e2"><div class="ttname"><a href="group__run.html#ga287c866466f6b7ed0beea1854f72b0e2">i_perform_resource_service_request</a></div><div class="ttdeci">int i_perform_resource_service_request(struct _i_session *i_session, struct _u_request *http_request, struct _u_response *http_response, int refresh_if_expired, int bearer_type, int use_dpop, time_t dpop_iat)</div><div class="ttdef"><b>Definition:</b> iddawc.c:5648</div></div>
</div><!-- fragment --><p>Here is an example of how to use <code>i_perform_resource_service_request</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct__i__session.html">_i_session</a> i_session;</div>
<div class="line"><span class="keyword">struct </span>_u_request req;</div>
<div class="line"><span class="keyword">struct </span>_u_response resp;</div>
<div class="line">json_t * j_resp;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__core.html#ga43fa354058e5ebc2c4d02ef3e9e62687">i_init_session</a>(&amp;i_session);</div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * All the process to get an access token is hidden, this example considers the _i_session has an access token</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line">ulfius_init_request(&amp;req);</div>
<div class="line">ulfius_init_response(&amp;resp);</div>
<div class="line"> </div>
<div class="line">ulfius_set_request_properties(&amp;req, U_OPT_HTTP_VERB, <span class="stringliteral">&quot;GET&quot;</span>, U_OPT_HTTP_URL, <span class="stringliteral">&quot;https://resource.tld/object&quot;</span>, U_OPT_NONE);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__run.html#ga287c866466f6b7ed0beea1854f72b0e2">i_perform_resource_service_request</a>(&amp;i_session, &amp;req, &amp;resp, 1, <a class="code" href="group__const.html#ga31a37a18a330e9643b08a380aecfc4f2">I_BEARER_TYPE_HEADER</a>, 1) == <a class="code" href="group__const.html#gac3e719888cb77e5de100927c5697a4ec">I_OK</a> &amp;&amp; resp.status == 200) {</div>
<div class="line">  <span class="comment">// j_resp contains the JSON response of the protected resource</span></div>
<div class="line">  j_resp = ulfius_get_json_body_response(&amp;resp, NULL);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__core.html#ga6a2fefde91c578c8c2f6b0297e3ee058">i_clean_session</a>(&amp;i_session);</div>
<div class="line">ulfius_clean_request(&amp;req);</div>
<div class="line">ulfius_clean_response(&amp;resp);</div>
<div class="line">json_decref(j_resp);</div>
<div class="ttc" id="agroup__const_html_ga31a37a18a330e9643b08a380aecfc4f2"><div class="ttname"><a href="group__const.html#ga31a37a18a330e9643b08a380aecfc4f2">I_BEARER_TYPE_HEADER</a></div><div class="ttdeci">#define I_BEARER_TYPE_HEADER</div><div class="ttdoc">Bearer type header, the token will be available in the header.</div><div class="ttdef"><b>Definition:</b> iddawc.h:82</div></div>
<div class="ttc" id="agroup__const_html_gac3e719888cb77e5de100927c5697a4ec"><div class="ttname"><a href="group__const.html#gac3e719888cb77e5de100927c5697a4ec">I_OK</a></div><div class="ttdeci">#define I_OK</div><div class="ttdoc">Success.</div><div class="ttdef"><b>Definition:</b> iddawc.h:44</div></div>
</div><!-- fragment --><h2>CIBA Requests</h2>
<p>Iddawc can run CIBA requests as defined in the documentation <a href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html">OpenID Connect Client-Initiated Backchannel Authentication Flow - Core 1.0</a>.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga62c4e9913754936cdbe83e5349acc22f">i_run_ciba_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div>
<div class="ttc" id="agroup__run_html_ga62c4e9913754936cdbe83e5349acc22f"><div class="ttname"><a href="group__run.html#ga62c4e9913754936cdbe83e5349acc22f">i_run_ciba_request</a></div><div class="ttdeci">int i_run_ciba_request(struct _i_session *i_session)</div><div class="ttdef"><b>Definition:</b> iddawc.c:6187</div></div>
</div><!-- fragment --><p>Example of using <code>i_run_ciba_request</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="struct__i__session.html">_i_session</a> i_session;</div>
<div class="line"><a class="code" href="group__core.html#ga43fa354058e5ebc2c4d02ef3e9e62687">i_init_session</a>(&amp;i_session);</div>
<div class="line"><a class="code" href="group__properties.html#ga74f0a21ec2933521d50a93062a2ff522">i_set_parameter_list</a>(&amp;i_session, <a class="code" href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41ad784b2e55cb95f331bd67212418b3323">I_OPT_RESPONSE_TYPE</a>, <a class="code" href="group__const.html#ga2baea50f6688abaea46fe0f413776fc7">I_RESPONSE_TYPE_CIBA</a>,</div>
<div class="line">                                 <a class="code" href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41a5dcda0d36970e7080d685e62ab9a867c">I_OPT_OPENID_CONFIG_ENDPOINT</a>, <span class="stringliteral">&quot;https://as.tld/.well-known/openid-configuration&quot;</span>,</div>
<div class="line">                                 <a class="code" href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41ad555d67cfd0d1d15c50f73f308ff4b40">I_OPT_CLIENT_ID</a>, <span class="stringliteral">&quot;client&quot;</span>,</div>
<div class="line">                                 <a class="code" href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41ac593baf31db5c21299aedd709b44fa1c">I_OPT_CLIENT_SECRET</a>, <span class="stringliteral">&quot;secret&quot;</span>,</div>
<div class="line">                                 <a class="code" href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41adaa64fb80bda1ea21bf0f412a38254fb">I_OPT_AUTH_METHOD</a>, <a class="code" href="group__const.html#gaace2a768c87c78505d9d2760913de5d7">I_TOKEN_AUTH_METHOD_SECRET_BASIC</a>,</div>
<div class="line">                                 <a class="code" href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41aee9b0f29db48b158568705694b73a1f9">I_OPT_SCOPE</a>, <span class="stringliteral">&quot;openid&quot;</span>,</div>
<div class="line">                                 <a class="code" href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41a4064e3703183c7da7b78c5ad724e43e8">I_OPT_CIBA_LOGIN_HINT</a>, <span class="stringliteral">&quot;{\&quot;username\&quot;:\&quot;ciba\&quot;}&quot;</span>,</div>
<div class="line">                                 <a class="code" href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41a8eac67f9a85507c398e47cab7612d7a5">I_OPT_CIBA_MODE</a>, <a class="code" href="group__const.html#ga0bef20052c612a6792f29d04543c0346">I_CIBA_MODE_POLL</a>,</div>
<div class="line">                                 <a class="code" href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41a5d8b737b36c654fb405cd7a6081fccdf">I_OPT_CIBA_LOGIN_HINT_FORMAT</a>, <a class="code" href="group__const.html#ga6d3f23c7211e13ca4ecfaf683e7dc9b3">I_CIBA_LOGIN_HINT_FORMAT_JSON</a>,</div>
<div class="line">                                 <a class="code" href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41a72d26a750fcc218aac5e3981e0b8fc22">I_OPT_NONE</a>);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__run.html#gaa93fb87ef370ffce18d3713c07947c88">i_get_openid_config</a>(&amp;i_session); <span class="comment">// get CIBA endpoint</span></div>
<div class="line"><a class="code" href="group__run.html#ga62c4e9913754936cdbe83e5349acc22f">i_run_ciba_request</a>(&amp;i_session); <span class="comment">// run request and store auth_req_id</span></div>
<div class="line"><a class="code" href="group__run.html#gaf251643a2384c854091a2df0314aac8e">i_run_token_request</a>(&amp;i_session); <span class="comment">// get access_token and refresh_token when the user has completed the authentication</span></div>
<div class="ttc" id="agroup__const_html_ga0bef20052c612a6792f29d04543c0346"><div class="ttname"><a href="group__const.html#ga0bef20052c612a6792f29d04543c0346">I_CIBA_MODE_POLL</a></div><div class="ttdeci">#define I_CIBA_MODE_POLL</div><div class="ttdef"><b>Definition:</b> iddawc.h:122</div></div>
<div class="ttc" id="agroup__const_html_ga2baea50f6688abaea46fe0f413776fc7"><div class="ttname"><a href="group__const.html#ga2baea50f6688abaea46fe0f413776fc7">I_RESPONSE_TYPE_CIBA</a></div><div class="ttdeci">#define I_RESPONSE_TYPE_CIBA</div><div class="ttdoc">Grant type urn:openid:params:grant-type:ciba.</div><div class="ttdef"><b>Definition:</b> iddawc.h:59</div></div>
<div class="ttc" id="agroup__const_html_ga6d3f23c7211e13ca4ecfaf683e7dc9b3"><div class="ttname"><a href="group__const.html#ga6d3f23c7211e13ca4ecfaf683e7dc9b3">I_CIBA_LOGIN_HINT_FORMAT_JSON</a></div><div class="ttdeci">#define I_CIBA_LOGIN_HINT_FORMAT_JSON</div><div class="ttdef"><b>Definition:</b> iddawc.h:126</div></div>
<div class="ttc" id="agroup__const_html_gaace2a768c87c78505d9d2760913de5d7"><div class="ttname"><a href="group__const.html#gaace2a768c87c78505d9d2760913de5d7">I_TOKEN_AUTH_METHOD_SECRET_BASIC</a></div><div class="ttdeci">#define I_TOKEN_AUTH_METHOD_SECRET_BASIC</div><div class="ttdoc">token endpoint using HTTP basic auth with client_id and client password</div><div class="ttdef"><b>Definition:</b> iddawc.h:69</div></div>
<div class="ttc" id="agroup__const_html_gga845a2122b22dd4f5a7f66c7d3bce2b41a4064e3703183c7da7b78c5ad724e43e8"><div class="ttname"><a href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41a4064e3703183c7da7b78c5ad724e43e8">I_OPT_CIBA_LOGIN_HINT</a></div><div class="ttdeci">@ I_OPT_CIBA_LOGIN_HINT</div><div class="ttdoc">CIBA login_hint value, mandatory on CIBA requests.</div><div class="ttdef"><b>Definition:</b> iddawc.h:239</div></div>
<div class="ttc" id="agroup__const_html_gga845a2122b22dd4f5a7f66c7d3bce2b41a5d8b737b36c654fb405cd7a6081fccdf"><div class="ttname"><a href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41a5d8b737b36c654fb405cd7a6081fccdf">I_OPT_CIBA_LOGIN_HINT_FORMAT</a></div><div class="ttdeci">@ I_OPT_CIBA_LOGIN_HINT_FORMAT</div><div class="ttdoc">CIBA login_hint format, values available are I_CIBA_LOGIN_HINT_FORMAT_JSON, I_CIBA_LOGIN_HINT_FORMAT_...</div><div class="ttdef"><b>Definition:</b> iddawc.h:240</div></div>
<div class="ttc" id="agroup__const_html_gga845a2122b22dd4f5a7f66c7d3bce2b41a5dcda0d36970e7080d685e62ab9a867c"><div class="ttname"><a href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41a5dcda0d36970e7080d685e62ab9a867c">I_OPT_OPENID_CONFIG_ENDPOINT</a></div><div class="ttdeci">@ I_OPT_OPENID_CONFIG_ENDPOINT</div><div class="ttdoc">absolute url for the .well-known/openid-configuration endpoint, string</div><div class="ttdef"><b>Definition:</b> iddawc.h:150</div></div>
<div class="ttc" id="agroup__const_html_gga845a2122b22dd4f5a7f66c7d3bce2b41a72d26a750fcc218aac5e3981e0b8fc22"><div class="ttname"><a href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41a72d26a750fcc218aac5e3981e0b8fc22">I_OPT_NONE</a></div><div class="ttdeci">@ I_OPT_NONE</div><div class="ttdoc">Empty option to complete a i_set_parameter_list.</div><div class="ttdef"><b>Definition:</b> iddawc.h:136</div></div>
<div class="ttc" id="agroup__const_html_gga845a2122b22dd4f5a7f66c7d3bce2b41a8eac67f9a85507c398e47cab7612d7a5"><div class="ttname"><a href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41a8eac67f9a85507c398e47cab7612d7a5">I_OPT_CIBA_MODE</a></div><div class="ttdeci">@ I_OPT_CIBA_MODE</div><div class="ttdoc">backchannel token delivery mode, values available are I_CIBA_MODE_NONE, I_CIBA_MODE_POLL,...</div><div class="ttdef"><b>Definition:</b> iddawc.h:237</div></div>
<div class="ttc" id="agroup__const_html_gga845a2122b22dd4f5a7f66c7d3bce2b41ac593baf31db5c21299aedd709b44fa1c"><div class="ttname"><a href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41ac593baf31db5c21299aedd709b44fa1c">I_OPT_CLIENT_SECRET</a></div><div class="ttdeci">@ I_OPT_CLIENT_SECRET</div><div class="ttdoc">client secret, string</div><div class="ttdef"><b>Definition:</b> iddawc.h:145</div></div>
<div class="ttc" id="agroup__const_html_gga845a2122b22dd4f5a7f66c7d3bce2b41ad555d67cfd0d1d15c50f73f308ff4b40"><div class="ttname"><a href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41ad555d67cfd0d1d15c50f73f308ff4b40">I_OPT_CLIENT_ID</a></div><div class="ttdeci">@ I_OPT_CLIENT_ID</div><div class="ttdoc">client_id, string</div><div class="ttdef"><b>Definition:</b> iddawc.h:144</div></div>
<div class="ttc" id="agroup__const_html_gga845a2122b22dd4f5a7f66c7d3bce2b41ad784b2e55cb95f331bd67212418b3323"><div class="ttname"><a href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41ad784b2e55cb95f331bd67212418b3323">I_OPT_RESPONSE_TYPE</a></div><div class="ttdeci">@ I_OPT_RESPONSE_TYPE</div><div class="ttdoc">response_type, values available are I_RESPONSE_TYPE_CODE, I_RESPONSE_TYPE_TOKEN, I_RESPONSE_TYPE_ID_T...</div><div class="ttdef"><b>Definition:</b> iddawc.h:137</div></div>
<div class="ttc" id="agroup__const_html_gga845a2122b22dd4f5a7f66c7d3bce2b41adaa64fb80bda1ea21bf0f412a38254fb"><div class="ttname"><a href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41adaa64fb80bda1ea21bf0f412a38254fb">I_OPT_AUTH_METHOD</a></div><div class="ttdeci">@ I_OPT_AUTH_METHOD</div><div class="ttdoc">Authentication method to use with the auth endpoint, values available are I_AUTH_METHOD_GET,...</div><div class="ttdef"><b>Definition:</b> iddawc.h:162</div></div>
<div class="ttc" id="agroup__const_html_gga845a2122b22dd4f5a7f66c7d3bce2b41aee9b0f29db48b158568705694b73a1f9"><div class="ttname"><a href="group__const.html#gga845a2122b22dd4f5a7f66c7d3bce2b41aee9b0f29db48b158568705694b73a1f9">I_OPT_SCOPE</a></div><div class="ttdeci">@ I_OPT_SCOPE</div><div class="ttdoc">scope values, string, multiple scopes must be separated by a space character: &quot;scope1 openid&quot;</div><div class="ttdef"><b>Definition:</b> iddawc.h:138</div></div>
</div><!-- fragment --><p>Note that when using ping or push mode, Iddawc doesn't implement the client notification endpoint, its implementation and communication with iddawc's session will be yours to make.</p>
<h2>End session</h2>
<p>Iddawc provides 3 functions dedicated to end session capabilities: <a href="https://openid.net/specs/openid-connect-frontchannel-1_0.html">OpenID Connect Front-Channel Logout</a> and <a href="https://openid.net/specs/openid-connect-backchannel-1_0.html">OpenID Connect Back-Channel Logout</a>.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> * <a class="code" href="group__run.html#ga6a716a75cddc5ee2a1be4d35c908f390">i_build_end_session_url</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#ga10894505403f690e0dce303607f3cfc0">i_verify_end_session_backchannel_token</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * token);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__run.html#gafa6f85f310dccda2962ccf09815c2eb9">i_close_session</a>(<span class="keyword">struct</span> <a class="code" href="struct__i__session.html">_i_session</a> * i_session, <span class="keyword">const</span> <span class="keywordtype">char</span> * sid);</div>
<div class="ttc" id="agroup__run_html_ga10894505403f690e0dce303607f3cfc0"><div class="ttname"><a href="group__run.html#ga10894505403f690e0dce303607f3cfc0">i_verify_end_session_backchannel_token</a></div><div class="ttdeci">int i_verify_end_session_backchannel_token(struct _i_session *i_session, const char *token)</div><div class="ttdef"><b>Definition:</b> iddawc.c:6427</div></div>
<div class="ttc" id="agroup__run_html_ga6a716a75cddc5ee2a1be4d35c908f390"><div class="ttname"><a href="group__run.html#ga6a716a75cddc5ee2a1be4d35c908f390">i_build_end_session_url</a></div><div class="ttdeci">char * i_build_end_session_url(struct _i_session *i_session)</div><div class="ttdef"><b>Definition:</b> iddawc.c:6412</div></div>
<div class="ttc" id="agroup__run_html_gafa6f85f310dccda2962ccf09815c2eb9"><div class="ttname"><a href="group__run.html#gafa6f85f310dccda2962ccf09815c2eb9">i_close_session</a></div><div class="ttdeci">int i_close_session(struct _i_session *i_session, const char *sid)</div><div class="ttdef"><b>Definition:</b> iddawc.c:6478</div></div>
</div><!-- fragment --><p>Even if Iddawc doesn't provide Front-Channel or Back-Channel logout endpoints, you can use the function <code>i_verify_end_session_backchannel_token</code> to verify an end_session backchannel token, and <code>i_close_session</code> to clean the current session. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
